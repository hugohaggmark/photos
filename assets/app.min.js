const container=document.getElementById("container"),root=document.getElementById("photos"),PHOTOS_TO_LOAD=5,_photoGroups=[];let _previousY=0,_previousRatio=0,_startPhoto=0,_endPhoto=_startPhoto+5,_observer=null;function parsePhotos(){let t={caption:media.photos[0].caption,location:media.photos[0].location,taken_at:media.photos[0].taken_at,photos:[]};for(let e=0;e<media.photos.length;e++){const o=media.photos[e];t.caption===o.caption&&t.photos.push(o.path),t.caption!==o.caption&&(_photoGroups.push(t),t={caption:o.caption,location:o.location,taken_at:o.taken_at,photos:[o.path]})}}function getWidth(){return document.body.clientWidth<800?document.body.clientWidth-2:document.body.clientWidth/2}function resizeContainer(){container.setAttribute("style",`max-width:${getWidth()+1}px;`)}function resizeImages(){root.querySelectorAll("img").forEach(t=>{t.setAttribute("width",getWidth())})}function loadPhotos(){resizeContainer();const t=getWidth();for(let e=_startPhoto;e<_endPhoto;e++){const o=_photoGroups[e],n=e===_endPhoto-1,a=document.createElement("div");if(a.setAttribute("class","card photo-container"),n){const t=document.getElementById("scroll-target");t&&(_observer.unobserve(t),t.removeAttribute("id")),a.setAttribute("id","scroll-target")}if(1===o.photos.length&&(addPhotoContainer(o,t,a),root.appendChild(a)),o.photos.length>1){const n=`carousel-${e}`,i=`carousel-arrow-left-${e}`,s=`carousel-arrow-right-${e}`,{slider:r}=addCarousel(o,t,n,i,s,a);root.appendChild(a),addKeenSlider(r,i,s)}}const e=document.getElementById("scroll-target");_observer.observe(e),lazyload()}function addCarousel(t,e,o,n,a,i){const{photos:s,location:r,taken_at:d,caption:c}=t,l=document.createElement("div");l.setAttribute("class","carousel-wrapper");const u=document.createElement("div");u.setAttribute("id",o),u.setAttribute("class","keen-slider");for(const t of s){const o=document.createElement("div");o.setAttribute("class","keen-slider__slide");const n=addImage(t,c,e,!1);o.appendChild(n),u.appendChild(o)}const p=document.createElement("div");p.setAttribute("id",n),p.setAttribute("class","carousel-arrows carousel-arrow-left");const h=document.createElement("div");h.setAttribute("id",a),h.setAttribute("class","carousel-arrows carousel-arrow-right"),l.appendChild(u),l.appendChild(p),l.appendChild(h);const m=addCaptionContainer(c,r,d);return i.appendChild(l),i.appendChild(m),{slider:u}}function addKeenSlider(t,e,o){new KeenSlider(t,{created:function(t){document.getElementById(e).addEventListener("click",function(){t.prev()}),document.getElementById(o).addEventListener("click",function(){t.next()})},slideChanged(t){onSlideChange(t,e,o)}})}function addPhotoContainer(t,e,o){const{caption:n,location:a,taken_at:i,photos:s}=t,r=document.createElement("div"),d=addImage(s[0],n,e,!0);r.appendChild(d);const c=addCaptionContainer(n,a,i);o.appendChild(r),o.appendChild(c)}function addImage(t,e,o,n){const a=document.createElement("img");return a.setAttribute("alt",e),a.setAttribute("width",o),a.setAttribute("height","auto"),n&&(a.setAttribute("class","lazyload"),a.setAttribute("src","#"),a.setAttribute("data-src","assets/"+t)),n||a.setAttribute("src","assets/"+t),a}function addCaptionContainer(t,e,o){const n=document.createElement("div");n.setAttribute("class","caption-container");const a=document.createElement("div");return a.innerHTML=parseCaption(t||"Missing caption"),a.setAttribute("class","caption"),n.appendChild(a),addLocation(e,n),addTaken(o,n),n}function addLocation(t,e){if(t){const o=document.createElement("div");o.innerText=t,o.setAttribute("class","location"),e.appendChild(o)}}function addTaken(t,e){if(t){const o=document.createElement("div"),n=new Date(t),a=n.getMinutes()+n.getTimezoneOffset(),i=n.getTime()+1e3*a,s=new Date(i);s.setUTCHours(0,0,0,0),o.innerText=s.toISOString().substring(0,10),o.setAttribute("class","taken"),e.appendChild(o)}}function parseCaption(t){let e="";const o=t.split("\n");for(line of o){if(""===line)continue;const t=/^(http|https)\:\/\/[a-zA-Z0-9\-\.]+.[a-zA-Z]{2,6}(\/\S*)?$/gm,o='<a class="tag" href="$&" target="_blank" rel="noopener">$&</a>';line=line.replace(t,o);const n=/#(\w+)/gim,a='<a class="tag" href="https://duckduckgo.com/?q=$1&iax=images&ia=images" target="_blank" rel="noopener">$&</a>';line=line.replace(n,a),e+=`<p>${line}</p>`}return e}function onSlideChange(t,e,o){const n=t.details().relativeSlide,a=document.getElementById(e),i=document.getElementById(o);0===n?a.classList.add("carousel-arrow-disabled"):a.classList.remove("carousel-arrow-disabled"),n===t.details().size-1?i.classList.add("carousel-arrow-disabled"):i.classList.remove("carousel-arrow-disabled")}function consent(){document.getElementById("cookie").classList.add("hidden"),localStorage.setItem("hugo.photos.consent","yes")}_observer||(_observer=new IntersectionObserver(function(t){const e=t[0],o=e.boundingClientRect.y,n=e.intersectionRatio,a=e.isIntersecting;o<_previousY&&n>_previousRatio&&a&&(_endPhoto=(_startPhoto=_endPhoto)+5>=_photoGroups.length?media.photos.length:_startPhoto+5,loadPhotos()),_previousY=o,_previousRatio=n},{threshold:[0]})),window.addEventListener("resize",function(){resizeContainer(),resizeImages()}),parsePhotos(),loadPhotos();const consented=localStorage.getItem("hugo.photos.consent");if("yes"!==consented){document.getElementById("cookie").classList.remove("hidden")}
